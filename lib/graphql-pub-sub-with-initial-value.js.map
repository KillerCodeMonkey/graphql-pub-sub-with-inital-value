{"version":3,"file":"graphql-pub-sub-with-initial-value.js","sources":["../src/index.ts"],"sourcesContent":["import { PubSub } from 'graphql-subscriptions'\n\nexport interface AsyncIterableIteratorWithInitialState<T> extends AsyncIterableIterator<T> {\n  initialValuePushed: boolean\n}\n\nexport class PubSubWithIntialValue extends PubSub {\n  private withInitialValue<T>(iterator: AsyncIterator<T>, getInitialValue: () => Promise<T>): AsyncIterableIteratorWithInitialState<T> {\n    return {\n      [Symbol.asyncIterator](): AsyncIterableIterator<T> { return this },\n      initialValuePushed: false,\n      next(value?: any): Promise<IteratorResult<T>> {\n        if (this.initialValuePushed) {\n          return iterator.next(value).then(({ value, done }: IteratorResult<T>): IteratorResult<T> => ({\n            done,\n            value\n          }))\n        } else {\n          return getInitialValue().then((value: T): IteratorResult<T> => {\n            this.initialValuePushed = true\n            return { done: false, value }\n          })\n        }\n      },\n      return(value?: any): Promise<IteratorResult<T>> {\n        return iterator.return!(value)\n      },\n      throw(value?: any): Promise<IteratorResult<T>> {\n        return iterator.throw!(value)\n      }\n    }\n  }\n\n  public asyncIteratorWithInitialValue<T>(topic: string | string[], initialValueFn: () => Promise<T>): AsyncIterableIteratorWithInitialState<T> {\n    return this.withInitialValue(this.asyncIterator<T>(topic), (): Promise<T> => initialValueFn())\n  }\n}\n"],"names":["withInitialValue","iterator","getInitialValue","Symbol","asyncIterator","this","initialValuePushed","next","value","then","ref","done","return","throw","asyncIteratorWithInitialValue","topic","initialValueFn","PubSub"],"mappings":"sNAOUA,0BAAoBC,EAA4BC,kBAC/C,IACJC,OAAOC,iCAAoDC,QAC5DC,oBAAoB,IACpBC,cAAKC,qBACCH,KAAKC,mBACAL,EAASM,KAAKC,GAAOC,cAAMC,uCAK3BR,IAAkBO,cAAMD,YACxBF,oBAAqB,EACnB,CAAEK,MAAM,QAAOH,QAI5BI,gBAAOJ,UACEP,EAASW,OAAQJ,MAE1BK,eAAML,UACGP,EAASY,MAAOL,mBAKtBM,uCAAiCC,EAA0BC,UACzDX,KAAKL,iBAAiBK,KAAKD,cAAiBW,qBAA0BC,UA5BtCC"}